\begin{lstlisting}    
/* GENERAL HELPERS NEEDED FOR THE SYSTEM */
/* loadusers() */
select * from users;

/* loadUser('name') */
select * from users where username = ? or id = ?, ['name', 'name'];

/* loadName('id') */
select username from users where id = ?, ['id'];

/* loadId('name') */
select id from users where username = ?, ['name'];

/* storeUser('user') */
insert into users (pass, username, mail VALUES (?, ?, ?), ['user'->pass, 'user'->username, 'user'->mail]);

/* findFriends('a', 'b') */
'idA' = loadUser('a')[0]->id;
'idB' = loadUser('b')[0]->id;
select * from friends where id1 = ? and id2 = ?, [min('idA', 'idB'), max('idA', 'idB')];

/* updateUser('id', 'data') */
update users SET username = ?, mail = ?, pass = ? where id = ? or username = ?, ['data'->username, 'data'->mail, 'data'->pass, 'id', 'id'];

/* function storeSerie('serie')*/
insert into series (title, description, makerId, tId) VALUES (?, ?, ?, ?), ['serie'->title, 'serie'->description, 'serie'->makerId, 'serie'->tId];

/* function loadSerieWithId('id')*/
select * from series where id = ?, ['id'];

/* function loadSerieWithIdOrTitle('id')*/
select * from series where id = ? or title = ?, ['id', 'id'];

/* function loadSerie('title', 'tId')*/
select * from series where title = ? and tId = ?, ['title', 'tId'];

/* function loadAllSeries()*/
select * from series;

/* function loadAllDistinctSeries()*/
select * from series group by title;

/* function updateSerie('id', 'serie', 'typeId')*/
update series SET title = ?, description = ?, tId = ? where id = ?,['serie'->title, 'serie'->description, 'typeId', 'id'];

/* function isMakerOfSeries('sId', 'mId')*/
select * from series where (id = ? or title = ?) and makerId = ?,['sId', 'sId', 'mId'];

/* function SerieContainsExercises('sId')*/
select * from exercises where serieId = ?,['sId'];

/* function loadExercisesFromSerie('sId')*/
select * from exercises where serieId = ?,['sId'];

/* function storeExercise('exercise')*/
insert into exercises (question, tips, start_code, expected_result, serieId) VALUES (?, ?, ?, ?, ?), ['exercise'->question, 'exercise'->tips, 'exercise'->start_code, 'exercise'->expected_result, 'exercise'->serieId];

/* function loadAllExercises()*/
select * from exercises;

/* function loadExercise('id')*/
select * from exercises where id = ?, ['id'];

/* function removeUnusedTypes()*/
delete from types where id NOT IN (select distinct(tId) from Series);

/* Subject and Difficulty => this combination is unique */
/* function loadTypeId('type')*/
select id from types where subject = ? and difficulty = ?, ['type'->subject, 'type'->difficulty];

/* function loadType1('type')*/
select * from types where subject = ? and difficulty = ?, ['type'->subject, 'type'->difficulty];

/* function loadType2('id')*/
select * from types where id = ?, ['id'];

/* function loadAllTypes()*/
select * from types;

/* function storeType('type')*/
insert into types (subject, difficulty) VALUES (?, ?), ['type'->subject, 'type'->difficulty];

/* function storeGroup('group')*/
insert into groups (name, founderId) VALUES (?, ?), ['group'->name, 'group'->founderId];

/* function loadAllGroups()*/
select * from groups ;

/* function loadGroup('group')*/
select * from groups where id = ? or name = ?, ['group', 'group'];

/* function isFounderOfGroup('groupId', 'founderId')*/
select * from groups where (id = ? or name = ?) and founderId = ?,['groupId', 'groupId', 'founderId'];

/* function addMember2Group('uId', 'gId')*/
'group' = loadGroup('gId');
insert into members_of_groups (memberId, groupId) VALUES (?, ?), ['uId', 'group'[0]->id];

/* function deleteMemberFromGroup('uId', 'gId')*/
'group' = loadGroup('gId');
delete from members_of_groups where memberId = ? and groupId = ?, ['uId', 'group'[0]->id];

/* function noMemberYet('uId', 'gId')*/
'group' = loadGroup('gId');
select * from members_of_groups where memberId = ? and groupId = ?,['uId', 'group'[0]->id];

/* function updateGroup('id', 'groupname')*/
'group' = loadGroup('id');
update groups SET name = ? where id = ?, ['groupname', 'group'[0]->id];

/* function storeAnswer('ans')*/
insert into exercises_answers (given_code, success, uId, eId) values (?, ?, ?, ?), ['ans'->given_code, 'ans'->success, 'ans'->uId, 'ans'->eId];

/* function notRatedYet('uId', 'sId')*/
select * from series_ratings where userId = ? and serieId = ?, ['uId', 'sId'];

/* function addRating('nr')*/
insert into series_ratings (rating, userId, serieId) VALUES (?, ?, ?), ['nr'->rating, 'nr'->userId, 'nr'->serieId];

/* function unratedSeries('sId')*/
select * from series_ratings where serieId = ?, ['sId'];

/* function storeConversation('id')  */
'userId' = loadUser('id')[0]->id;
INSERT INTO conversation (userA, userB) VALUE (?, ?), [min(\Auth::id(), 'userId'), max(\Auth::id(), 'userId')];

/* function loadConversation('id') */
'id' = loadUser('id')[0]->id;
SELECT * FROM conversations WHERE userA = ? AND userB = ?, [min(\Auth::id(), 'id'), max(\Auth::id(), 'id')];

/* function loadLatestConversation() */
SELECT C.userA, C.userB
FROM conversations C
    JOIN messages M ON C.id = M.conversationId
WHERE C.userA = ? OR C.userB = ?
ORDER BY date DESC
LIMIT 1,
[\Auth::id(), \Auth::id()];

/* function storeMessage('cId', 'message') */
INSERT INTO messages (conversationId, author, message) VALUE (?, ?, ?), ['cId', \Auth::id(), 'message'];

/* function loadAllMessagesInDB() */
SELECT userA, userB, message, date
FROM conversations
    JOIN messages ON conversations.id = messages.conversationId
ORDER BY date;


/* function loadAllMessages('id') */
'id2' = loadUser('id')[0]->id;
SELECT U.username,M.message,M.date
FROM conversations C
    JOIN messages M ON C.id = M.conversationId
    JOIN users U ON U.id = M.author
WHERE C.userA = ? AND C.userB = ?,
[min(\Auth::id(), 'id2'), max(\Auth::id(), 'id2')];

/* Get all conversations for the logged in user, then only select the latest message for each of them*/
/* function loadConversationsWithMessage()  */
select userA, userB, message, date
from (select C.id, C.userA, C.userB, M.message, M.date
    from conversations C
        join messages M on C.id = M.conversationId
        join users U on U.id = M.author
    where C.userA = ? or C.userB = ?
    order by date desc) as X
group by id
order by date desc,
[\Auth::id(), \Auth::id()];
\end{lstlisting}
